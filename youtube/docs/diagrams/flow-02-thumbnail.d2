# Scenario 2: With Thumbnail Only
# User requests thumbnail generation

direction: down

title: |md
  # Scenario 2: With Thumbnail
  **Request:** `{url: "...", options: {thumbnail: {mode: "auto"}}}`
|

start: START {
  shape: oval
  style.fill: "#4caf50"
}

stage1: Stage 1\ndownload_youtube_video {
  shape: rectangle
  style.fill: "#2196f3"
  style.stroke-width: 2
}

stage2: Stage 2\nextract_metadata {
  shape: rectangle
  style.fill: "#2196f3"
  style.stroke-width: 2
}

stage3: Stage 3\nsplit_video_into_chunks {
  shape: rectangle
  style.fill: "#2196f3"
  style.stroke-width: 2
}

decision: Check options.thumbnail? {
  shape: diamond
  style.fill: "#fff9c4"
  style.stroke: "#f57c00"
  style.stroke-width: 2
}

stage4: Stage 4\ngenerate_thumbnail {
  shape: rectangle
  style.fill: "#00bcd4"
  style.stroke: "#0097a7"
  style.stroke-width: 2
  
  label: |md
    **generate_thumbnail**
    mode: auto
    ↓
    FFmpeg: thumbnail filter
    ↓
    Upload to MinIO
  |
}

stage5_skip: Stage 5 (Chapters)\nSKIPPED {
  shape: rectangle
  style.fill: "#e0e0e0"
  style.stroke-dash: 3
}

stage6: Stage 6\ntranscode_chunk (parallel) {
  shape: rectangle
  style.fill: "#ff9800"
  style.stroke: "#e64a19"
  style.stroke-width: 3
}

stage7: Stage 7\ngenerate_hls_playlist {
  shape: rectangle
  style.fill: "#9c27b0"
  style.stroke-width: 2
}

stage8: Stage 8\ngenerate_master_playlist {
  shape: rectangle
  style.fill: "#9c27b0"
  style.stroke-width: 2
}

completion: Stage 9\nVideoCompletionWorkflow {
  shape: rectangle
  style.fill: "#4caf50"
  style.stroke-width: 2
}

end: END {
  shape: oval
  style.fill: "#4caf50"
}

# Flow
start -> stage1
stage1 -> stage2
stage2 -> stage3
stage3 -> decision

decision -> stage4: YES {
  style.stroke: "#00bcd4"
  style.stroke-width: 2
}

decision -> stage5_skip: NO

stage4 -> stage6: Runs in parallel {
  style.stroke: "#00bcd4"
  style.stroke-dash: 3
}

stage3 -> stage6: Main path continues

stage6 -> stage7
stage7 -> stage8
stage8 -> completion
completion -> end

# Annotations
note1: |md
  **Enhancement Path**
  Runs in parallel with transcoding
  Failure does NOT block video
| {
  style.fill: "#e1f5fe"
}

note2: |md
  **Result:**
  - Thumbnail: thumbnails/{video_id}/thumbnail.jpg
  - Video: Normal transcode
| {
  style.fill: "#fff9c4"
}
